[![Open in Visual Studio Code](https://classroom.github.com/assets/open-in-vscode-c66648af7eb3fe8bc4f294546bfd86ef473780cde1dea487d3c4ff354943c9ae.svg)](https://classroom.github.com/online_ide?assignment_repo_id=9071029&assignment_repo_type=AssignmentRepo)
# Лабораторная работа по курсу "Искусственный интеллект"
# Классификация изображений.

| Студент | *Калугин Кирилл Алексеевич* |
|------|------|
| Группа  | *7* |
| Оценка 1 (обучение "с нуля") | *X* |
| Оценка 2 (transfer learning) | *X* |
| Проверил | Сошников Д.В. |

> *Комментарии проверяющего*
### Задание

Решить задачу классификации пород кошек и собак на основе датасета [Oxford-IIIT](https://www.robots.ox.ac.uk/~vgg/data/pets/).

![Dataset we will deal with](images/data.png)

#### Задание 1: Классификация Pet Faces

Обучить свёрточную нейронную сеть для классификации пород кошек и собак на основе упрощённого датасета **Pet Faces**. Самостоятельно придумать архитектуру сети, реализовать предобработку входных данных.

Для загрузки датасета используйте следующий код:

```python
!wget https://mslearntensorflowlp.blob.core.windows.net/data/petfaces.tar.gz
!tar xfz petfaces.tar.gz
!rm petfaces.tar.gz
```

В качестве результата необходимо:

* Посчитать точность классификатора на тестовом датасете
* Посчитать точность двоичной классификации "кошки против собак" на текстовом датасете
* Построить confusion matrix
* **[На хорошую и отличную оценку]** Посчитайте top-3 accuracy
* **[На отличную оценку]** Выполнить оптимизацию гиперпараметров: архитектуры сети, learning rate, количества нейронов и размеров фильтров.

Решение оформите в файле [Faces.ipynb](Faces.ipynb).

Использовать нейросетевой фреймворк в соответствии с вариантом задания:
   * Чётные варианты - PyTorch
   * Нечётные варианты - Tensorflow/Keras
#### Задание 2: Классификация полных изображений с помощью transfer learning

Используйте оригинальный датасет **Oxford Pets** и предобученные сети VGG-16/VGG-19 и ResNet для построение классификатора пород. Для загрузки датасета используйте код:

```python
!wget https://mslearntensorflowlp.blob.core.windows.net/data/oxpets_images.tar.gz
!tar xfz oxpets_images.tar.gz
!rm oxpets_images.tar.gz
```

В качестве результата необходимо:

* Посчитать точность классификатора на тестовом датасете отдельно для VGG-16/19 и ResNet, для дальнейших действий выбрать сеть с лучшей точностью
* Посчитать точность двоичной классификации "кошки против собак" на текстовом датасете
* Построить confusion matrix
* **[На отличную оценку]** Посчитайте top-3 и top-5 accuracy

Решение оформите в файле [Pets.ipynb](Pets.ipynb).

Использовать нейросетевой фреймворк, отличный от использованного в предыдущем задании, в соответствии с вариантом задания:
   * Нечётные варианты - PyTorch
   * Чётные варианты - Tensorflow/Keras

## Отчет

### Первая часть

В данной части ЛР я создавал сверточную сеть "с нуля". Структура сети следующая:
- 4 линейных слоя
- 3 фильтра
- Активационные функции - tanh и ReLU
- Функция потерь - categorical crossentropy
- Алгоритм оптимизации - Adam с learnig rate = 0.0001

Эта модель дает около 55% точности на валидационной выборке, что я вляется лучшим, достигнутым мной результатом.

![image](https://user-images.githubusercontent.com/71846372/198740817-f3035b4c-f130-4723-848b-c9d2d0cc38ed.png)

![image](https://user-images.githubusercontent.com/71846372/198740826-b840be1d-3c62-49db-ae14-e8f712645dec.png)

Точность определения животного (кошка/собака) составила 85%.

### Вторая часть

Во второй части использовались предобученые модели vgg16 и resnet.

Для vgg16 я смог получить точность в 83% для определения породы и 99% для определения вида.

![image](https://user-images.githubusercontent.com/71846372/198741454-508c158a-f339-4485-bf1f-94f91e798f07.png)



Однако в случае resnet мне не удалось получить точность при определении породы выше 3% на тестовой выборке. При этом во время обучения точность достигает почти 93%. Возможно модель переобучается.

При определении вида модель достигла 69% точности.

![image](https://user-images.githubusercontent.com/71846372/198741689-0745178a-edcd-4470-84d6-16e540cc1df1.png)

### Проблемы

В ходе выполнения работы я встретился со следующими проблемами:

- ссылка для загрузки датасета не работала, поэтому мне пришлось получать датасет через одногрупников. 
- чрезвычайно долгое обучение сети. Тк мне не удалось перенести вычисления на GPU, в одном из случаев сеть обучалась почти 5 часов. Из-за этого я не смог достаточно хорошо подобрать гиперпараметры, что, возможно, привело к достаточно низким показателям точности.

### Выводы

В ходе данной работы я получил опыт работы со сверточными сетями. Они работают с изображениями намного лучше, чем обычные нейронные сети, которые я реализовывал в предыдущей ЛР, однако требуют существенно больше ресурсов для работы. Кроме того, я познакомился с практически незнакомым мне фреймворком PyTorch.


## Codespaces

По возможности, используйте GitHub Codespaces для выполнения работы. По результатам, дайте обратную связь:
1. Что понравилось?
1. Что не понравилось?
1. Какие ошибки или существенные затруднения в работе вы встречали? (По возможности, будьте как можно более подробны, указывайте шаги для воспроизведения ошибок)

## Материалы для изучения

* [Deep Learning for Image Classification Workshop](https://github.com/microsoft/workshop-library/blob/main/full/deep-learning-computer-vision/README.md)
* [Convolutional Networks](https://github.com/microsoft/AI-For-Beginners/blob/main/4-ComputerVision/07-ConvNets/README.md)
* [Transfer Learning](https://github.com/microsoft/AI-For-Beginners/blob/main/4-ComputerVision/08-TransferLearning/README.md)
